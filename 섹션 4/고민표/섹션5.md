### 1. 로드 밸런서

 로드 밸런서는 네트워크 트래픽을 여러 서버(예: EC2 인스턴스, 컨테이너 IP 주소 등)에 효과적으로 **분산**하는 서비스입니다. 이를 통해 서버의 부하를 고르게 나누고, 웹 애플리케이션의 **고가용성과 확장성**을 보장합니다.



### 2. 트래픽 분산 방식

#### a. 애플리케이션 로드 밸런서 (ALB)

- **HTTP 헤더 기반 라우팅**: 로드 밸런서는 HTTP 요청의 내용을 분석하여 트래픽을 처리합니다. 예를 들어, URL 경로나 HTTP 헤더의 값을 참조해 특정 서버에 요청을 전송할 수 있습니다.

- **적합한 서비스**: 이 방식은 웹 애플리케이션에 적합하며, HTTPS와 같은 보안 프로토콜을 포함하여 HTTP 트래픽을 효과적으로 처리합니다.

- **기능 예시**: URL 경로에 따른 서비스 분기, 사용자 세션 관리 등 다양한 기능을 지원하여 동적 웹 애플리케이션의 요구를 충족합니다.



#### b. 네트워크 로드 밸런서 (NLB)

- **프로토콜 및 포트 번호 기반 라우팅**: 로드 밸런서는 TCP/UDP 프로토콜의 포트 번호, IP, TCP세션을 기준으로 트래픽을 처리합니다. 

- **용도**: 고속으로 수십억 건의 요청을 처리해야 하는 대용량 트래픽 상황에서도 안정적으로 작동하며, TLS(전송 계층 보안), UDP, TCP를 지원하여 다양한 전송 요구사항에 적합합니다.

- **기능 예시**: EC2 인스턴스에서 실행되는 다양한 서비스에 대한 고가용성을 보장합니다.



### c. 게이트웨이 로드 밸런서

- **게이트웨이 로드 밸런서**는 Geneve 프로토콜을 사용하여 패킷을 캡슐화하여 네트워크 내에서 트래픽을 효과적으로 처리할 수 있도록 돕습니다. 이를 통해 연결된 VPC 내의 자원과 외부 네트워크 간의 유연한 트래픽 관리가 가능해집니다.

- **용도**: 트래픽 검사, 보안



### 3. 리스너 (Listener)

 리스너는 클라이언트의 요청을 수신하고 이를 적절한 타겟 그룹에 라우팅하기 위한 규칙을 정의합니다. 리스너는 특정 프로토콜(예: HTTP, HTTPS, TCP) 및 포트(예: 80, 443)에서 작동합니다.



#### 리스너 규칙

\- **호스트 헤더 기반**: 특정 호스트 이름을 기준으로 요청을 다른 타겟 그룹으로 라우팅합니다. 예를 들어, `example.com`과 `test.example.com`에 대한 요청을 각각 다른 인스턴스로 전송할 수 있습니다.

\- **경로 기반 라우팅**: 요청 URI의 경로를 분석하여 `/audio`, `/video`와 같은 특정 경로에 대해 다른 대상 그룹으로 트래픽을 전송합니다.

\- **HTTP 헤더 기반**: HTTP 메서드(GET, POST 등)나 쿼리 문자열을 분석하여 조건에 맞는 라우팅을 수행합니다.

\- **소스 IP 기반**: 요청을 보낸 클라이언트의 IP 주소에 따라 특정 타겟 그룹으로 라우팅할 수도 있습니다.



### 4. 타겟 그룹 (Target Group)

타겟 그룹은 특정 라우팅을 수행하기 위한 대상을 모아놓은 집합체입니다. AWS에서는 다양한 대상으로 구성된 타겟 그룹을 지원하며, 이는 다음과 같습니다:

\- **EC2 인스턴스**: EC2 인스턴스에 대한 요청을 직접 수신합니다.

\- **EC2 오토 스케일링 그룹**: 오토 스케일링 기능을 사용하여 자동으로 인스턴스를 추가하거나 제거합니다.

\- **Lambda 함수**: 서버리스 애플리케이션을 구축할 때 Lambda 함수로의 요청을 라우팅할 수 있습니다.

\- **IP 주소**: VPC 외부의 자원이나 온프레미스 인프라의 IP 주소를 지정하여 요청을 전송할 수 있습니다.



### 5. 라우팅 방식

- **라운드 로빈** : 이 방식은 요청을 타겟 그룹 내의 인스턴스에 순차적으로 분배하여 부하를 고르게 나누는 방법입니다.

- **최소 연결**: 이 방식은 현재 연결 수가 가장 적은 인스턴스에 새 요청을 할당합니다. 



### 6. AWS 로드밸런서 옵션 정보

ALB는 고급 애플리케이션 레벨의 로드 밸런서로, 주로 웹 애플리케이션 트래픽을 관리합니다.

\- **등록 취소 지연**: ALB는 오토 스케일링 그룹의 인스턴스가 축소될 때, 일정 시간 내에 해당 인스턴스에 요청을 보내지 않습니다. 이 시간 동안 인스턴스가 정상 상태로 돌아오지 않으면 더 이상 요청을 전달하지 않습니다.

\- **느린 시작 시간**: 인스턴스가 초기화되는 동안에는 요청을 받지 않도록 조정할 수 있습니다. 이는 초기화가 완료되기 전에 요청이 처리되지 않는 것을 방지합니다.

\- **세션 유지**: ALB는 **sticky sessions** 기능을 지원하여 동일한 인스턴스에 대한 연결을 유지할 수 있습니다. 이를 통해 세션 데이터를 잃지 않고, 효율적인 상태 관리가 가능합니다.

\- **교차 영역 로드 밸런서**: AWS의 교차 영역 로드 밸런서는 여러 가용 영역을 아우르는 트래픽 분산을 허용합니다. 일반적인 로드 밸런서는 특정 가용 영역 내에서만 트래픽을 분산시키지만, 교차 영역 로드 밸런서는 모든 가용 영역에 걸쳐 트래픽을 직접적으로 관리할 수 있도록 합니다.